<section class="projects">
    <h2 class="title">Últimos Proyectos</h2>

    <div class="filters" role="tablist" aria-label="Filtros de proyectos">
        <button *ngFor="let cat of categories" class="pill" [class.active]="cat === active()" (click)="setFilter(cat)"
            role="tab" [attr.aria-selected]="cat === active()">
            {{ cat }}
        </button>
    </div>

    <div class="projects-grid">
        <article class="p-card" *ngFor="let p of filtered(); trackBy: trackById; index as i" [class.open]="isOpen(p.id)"
            (click)="toggleCard(p.id, $event)" (keydown)="onKeydown($event, p.id)" role="button" tabindex="0"
            [attr.aria-label]="'Ver detalles del proyecto ' + p.title" [attr.aria-expanded]="isOpen(p.id)"
            [attr.data-aos]="'fade-up'" [attr.data-aos-delay]="i * 90" [attr.data-aos-offset]="80">
            <figure class="p-media">
                <img class="p-media-img" [src]="p.img" [alt]="p.title" loading="lazy" />
            </figure>

            <div class="p-frame"></div>

            <div class="p-content">
                <div class="p-meta">
                    <div class="p-meta-scroll" #meta [attr.data-id]="p.id" (mouseenter)="ensureState(meta, p.id)"
                        (focus)="ensureState(meta, p.id)" (touchstart)="ensureState(meta, p.id)"
                        (scroll)="onScroll(meta, p.id)">
                        <h3 class="title-line">{{ p.title }}</h3>
                        <p class="short-line" [innerHTML]="p.short"></p>

                        <div class="chips">
                            <span class="chip" *ngFor="let c of p.categories">{{ c }}</span>
                        </div>

                        <button class="ghost-cta" type="button" *ngIf="p.url" (click)="openProject($event, p.url)"
                            [attr.aria-label]="'Abrir ' + p.title + ' en GitHub'">
                            Ver proyecto en GitHub
                        </button>

                        <!-- NUEVO: Botón Video Demo (solo si existe p.videoUrl) -->
                        <button class="ghost-cta" type="button" *ngIf="p.videoUrl"
                            (click)="openVideo($event, p.videoUrl)"
                            aria-label="Ver Video Demo en YouTube (se abre en pestaña nueva)">
                            Video Demo
                        </button>
                    </div>

                    <div class="p-fade p-fade-top" *ngIf="!state(p.id).atTop" aria-hidden="true"></div>
                    <div class="p-fade p-fade-bottom" *ngIf="!state(p.id).atBottom" aria-hidden="true"></div>

                    <div class="p-scrollbar" *ngIf="state(p.id).can" aria-hidden="true">
                        <div class="thumb" [style.height.%]="state(p.id).thumbH" [style.top.%]="state(p.id).thumbTop">
                        </div>
                    </div>
                </div>
            </div>
        </article>
    </div>
</section>
